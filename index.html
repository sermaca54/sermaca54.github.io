<!DOCTYPE html>
<html>
  <head>
    <title>Testing</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/processing.js/1.6.6/processing.min.js"></script>
    <style>

    #boton {
      font-size: 20px;
      font-weight: bold;
      font-style: italic;
      border-radius: 10%;
      border-width: 5px;
      border-color: rgb(128, 74, 20);
      background: rgb(125, 117, 106);
      color: rgb(189, 187, 185);

      position: absolute;
      top: 15px;
      left: 880px;
    }
    </style>
 </head>
 <body>
   <input id="boton" type="button" value="Reset" onclick="location.reload()"/>

  <script type="text/processing" data-processing-target="mysketch">

    void setup(){
       size(1000, 450);

     }
     angleMode = "radians";
     frameRate(60);

     var Car = function() {
         this.position = new PVector(200, 200);
         this.velocity = new PVector(0, 0);
         this.acceleration = new PVector(0, 0);
         this.topspeed = 4;
         this.stop = true;
         this.start = false;
     };

     Car.prototype.impulsor = function() {
         var impulsor = this.velocity.get();
         impulsor.mult(1.25);
         this.position.add(impulsor);
     };


     Car.prototype.update = function () {
         this.velocity.add(this.acceleration);
         this.velocity.limit(this.topspeed);
         this.position.add(this.velocity);
         this.acceleration.mult(0);
     };

     Car.prototype.applyForce = function(force) {
         this.acceleration.add(force);
     };

     Car.prototype.turnLeft = function() {
       if (this.stop === false) {
         var fuerza = this.velocity.get();
         fuerza.rotate(-0.15);
         this.applyForce(fuerza);

       } else if (this.stop === true) {
          var paro = this.velocity.get();
          paro.mult(-1);
          var parado = PVector.add(this.velocity, paro);
          this.applyForce(parado);
       }
     };

     Car.prototype.turnRight = function() {
       if (this.stop === false) {
         var fuerza = this.velocity.get();
         fuerza.rotate(0.15);
         this.applyForce(fuerza);
       } else if (this.stop === true) {
         var paro = this.velocity.get();
         paro.mult(-1);
         var parado = PVector.add(this.velocity, paro);
         this.applyForce(parado);
       }

     };

     Car.prototype.brake = function() {
       var velocidad = this.velocity.get();
       var seguro = this.velocity.get();
       seguro.mult(-1);
       velocidad.mult(-1);
       velocidad.div(8);
       var comprobar = PVector.add(this.velocity, seguro);
       var paro = PVector.add(this.velocity, velocidad);
       if (paro === comprobar) {
           this.velocity.set(paro);
           this.stop = true;
       } else if (paro !== comprobar) {
           this.velocity.set(paro);
           this.stop = true;
       }

     };

     Car.prototype.mover = function() {
       if (this.start === false) {
         this.start = true;
         var copia_velocidad = this.velocity.get();
         var aumento = new PVector(4, 0);
         var velocidad = PVector.add(copia_velocidad, aumento);
         this.velocity.set(velocidad);
         this.stop = false;

       } else if (this.start === true) {
         var copia_velocidad = this.velocity.get();
         var aumento = this.velocity.get();
         aumento.normalize();
         var cifra = new PVector(0.001, 0.001);
         aumento.add(cifra);
         var velocidad = PVector.add(copia_velocidad, aumento);
         this.velocity.set(velocidad);
         this.stop = false;

       }

     };

     Car.prototype.display = function () {
         // Step 3:
         var angle = this.velocity.heading();

         stroke(0, 0, 0);
         strokeWeight(2);
         fill(127, 127, 127);
         pushMatrix();
         rectMode(CENTER);
         translate(this.position.x, this.position.y);
         // Step 3:
         rotate(angle);
         // draw the car
         fill(255, 0, 0);
         rect(0, 0, 70, 30);
         rect(0, 0, 29, 30);
         fill(79, 79, 79);
         ellipse(-15, -18, 20, 8);
         ellipse(-15, 18, 20, 8);
         ellipse(15, 18, 20, 8);
         ellipse(15, -18, 20, 8);
         rect(21, 0, 11, 26);
         popMatrix();
     };

     Car.prototype.checkEdges = function () {
         if (this.position.x > 1000) {
             this.position.x = 0;
         } else if (this.position.x < 0) {
             this.position.x = 1000
         }

         if (this.position.y > 310) {
             this.position.y = 85;
         } else if (this.position.y < 85) {
             this.position.y = 310;
         }
     };

     var Particle = function(position) {
         this.acceleration = new PVector(0, -0.05);
         this.velocity = new PVector(random(-1, 1), random(-1, 0));
         this.position = position.get();
         this.timeToLive = 50;
         this.radius = 10;
     };

     Particle.prototype.run = function() {
         this.update();
         this.display();
     };

     Particle.prototype.update = function(){
         this.velocity.add(this.acceleration);
         this.position.add(this.velocity);
         this.timeToLive -= 2;
     };

     Particle.prototype.display = function() {
         strokeWeight(1);
         stroke(0, 0, 0);
         fill(92, 89, 89);
         ellipse(this.position.x, this.position.y, this.radius, this.radius);

     };

     Particle.prototype.isDead = function() {
         if (this.timeToLive < 0) {
             return true;
         } else {
             return false;
         }
     };

     var ParticleSystem = function(position) {
         this.origin = position.get();
         this.particles = [];
     };

     ParticleSystem.prototype.addParticle = function() {
         this.particles.push(new Particle(this.origin));
     };

     ParticleSystem.prototype.run = function() {
         for (var i = this.particles.length-1; i >= 0; i--) {
             var p = this.particles[i];
             p.run();
             if (p.isDead()) {
                 this.particles.splice(i, 1);
             }
         }
     };

     var modelo_carro = function() {
         this.position = new PVector(500, 400);
     };

     modelo_carro.prototype.display = function () {
         stroke(0, 0, 0);
         strokeWeight(2);
         fill(127, 127, 127);
         pushMatrix();
         rectMode(CENTER);
         translate(this.position.x, this.position.y);
         // Step 3:
         // draw the car
         fill(255, 0, 0);
         rect(0, 0, 90, 40);
         rect(0, 0, 50, 40);
         fill(79, 79, 79);
         ellipse(-25, -25, 25, 10);
         ellipse(-25, 25, 25, 10);
         ellipse(15, 25, 25, 10);
         ellipse(15, -25, 25, 10);
         rect(25, 0, 15, 37);
         popMatrix();
     };

     var gota = function(x, y) {
       this.x = x;
       this.y = y;
       this.masa = 10;
     };

     gota.prototype.update = function() {
       this.x -= 4;
     };

     gota.prototype.check = function(x, y) {
       var d = dist(x, y, this.x, this.y);
       if (d < this.masa) {
         return true;
       }

     };

     gota.prototype.display = function() {
       fill(54, 52, 52);
       strokeWeight(5);
       stroke(18, 17, 17)
       ellipse(this.x, this.y, this.masa * 2, this.masa *2);
     };

     var caja = function(x, y) {
       this.x = x;
       this.y = y;
       this.width = 25;
       this.height = 25;
     }

     caja.prototype.update = function() {
       this.x -= 4;

     };

     caja.prototype.display = function() {
       strokeWeight(5);
       stroke(105, 63, 1);
       fill(153, 93, 3);
       rect(this.x, this.y, this.width, this.height);

       fill(2, 204, 222);
       stroke(3, 143, 156);
       strokeWeight(3);
       ellipse(this.x + 13, this.y + 13, 10, 10);

     };

     caja.prototype.check = function(x, y) {
       if ((x >= this.x && x <= (this.x + 25)) && (y >= this.y && (y <= this.y + 25))) {
         return true;
       }

     };


     var car = new Car();
     var masa = 40;
     var posicion_x = 750;
     var posicion_y = 395;
     var posicion_x_2 = 200;
     var posicion_y_2 = 395;
     var posicion_encender_x = 70;
     var posicion_encender_y = 370;
     var posicion_apagar_x = 270;
     var posicion_apagar_y = 370;
     var posicion_impulsar_x = 820;
     var posicion_impulsar_y = 370;
     var comprobar = function(x, y) {
       var d = dist(x, y, posicion_x, posicion_y);
       if (d < masa) {
           return true;
         }
     };

     var comprobar_2 = function(x, y) {
       var d = dist(x, y, posicion_x_2, posicion_y_2);
       if (d < masa) {
           return true;
         }
     };



     var encender = function(x, y) {
       if ((x >= posicion_encender_x && x <= (posicion_encender_x + 60)) && (y >= posicion_encender_y && (y <= posicion_encender_y + 40))) {
         return true;
       }
     };

     var apagar = function(x, y) {
       if ((x >= posicion_apagar_x && x <= (posicion_apagar_x + 60)) && (y >= posicion_apagar_y && (y <= posicion_apagar_y + 40))) {
         return true;
       }
     };

     var impulsar = function(x, y) {
       if ((x >= posicion_impulsar_x && x <= (posicion_impulsar_x + 60)) && (y >= posicion_impulsar_y && (y <= posicion_impulsar_y + 40))) {
         return true;
       }
     };

     var boton_acelerar_pulsado = function() {
       fill(69, 67, 67);
       strokeWeight(5);
       ellipse(posicion_x, posicion_y, masa * 2, masa * 2);
     };

     var boton_acelerar_sin_pulsar = function() {
       fill(125, 125, 125);
       stroke(0, 0, 0);
       strokeWeight(1);
       ellipse(posicion_x, posicion_y, masa * 2, masa * 2);
     };

     var boton_frenar_pulsado = function() {
       fill(69, 67, 67);
       strokeWeight(5);
       ellipse(posicion_x_2, posicion_y_2, masa * 2, masa * 2);

     };

     var boton_frenar_sin_pulsar = function() {
       fill(125, 125, 125);
       noStroke();
       stroke(0, 0, 0);
       strokeWeight(1);
       ellipse(posicion_x_2, posicion_y_2, masa * 2, masa * 2);

     };

     var boton_izquierdo_sin_pulsar = function() {
       fill(73, 74, 74);
       stroke(0, 0, 0);
       strokeWeight(3);
       triangle(220, 375, 220, 415, 170, 395);
     };

     var boton_izquierdo_pulsado = function() {
       fill(39, 40, 41);
       triangle(220, 375, 220, 415, 170, 395);
     };

     var boton_derecho_sin_pulsar = function() {
       fill(73, 74, 74);
       stroke(0, 0, 0);
       strokeWeight(3);
       triangle(730, 375, 730, 415, 780, 395);
     };

     var boton_derecho_pulsado = function() {
       fill(39, 40, 41);
       triangle(730, 375, 730, 415, 775, 395);
     };

     var panel = function() {
       strokeWeight(10);
       rect(500, 395, 990, 98);
     };

     var boton_encender = function() {
       strokeWeight(3);
       stroke(2, 117, 18);
       rectMode(CORNER);
       fill(3, 163, 25);
       rect(posicion_encender_x, posicion_encender_y, 60, 40);
       fill(255, 255, 255);
       textSize(30);
       text("ON", 77, 402);
     };

     var boton_encender_pulsado = function() {
       rectMode(CORNER);
       fill(4, 92, 16);
       rect(posicion_encender_x, posicion_encender_y, 60, 40);
       fill(152, 156, 153);
       textSize(30);
       text("ON", 77, 402);
     };

     var boton_apagar = function() {
       strokeWeight(3);
       stroke(140, 6, 6);
       fill(191, 2, 2);
       rectMode(CORNER);
       rect(posicion_apagar_x, posicion_apagar_y, 60, 40);
       fill(255, 255, 255);
       textSize(30);
       text("OF", 280, 402);
     };

     var boton_apagar_pulsado = function() {
       fill(130, 4, 4);
       rectMode(CORNER);
       rect(posicion_apagar_x, posicion_apagar_y, 60, 40);
       fill(152, 156, 153);
       textSize(30);
       text("OF", 280, 402);
     };

     var boton_impulsar = function() {
       strokeWeight(3);
       stroke(105, 96, 96);
       rectMode(CORNER);
       fill(138, 138, 138);
       rect(posicion_impulsar_x, posicion_impulsar_y, 60, 40);
       strokeWeight(5);
       stroke(0);
       line(850, 380, 830, 400);
       line(850, 380, 870, 400);
     };

     var boton_impulsar_pulsado = function() {
       strokeWeight(3);
       stroke(74, 68, 68);
       rectMode(CORNER);
       fill(92, 92, 92);
       rect(posicion_impulsar_x, posicion_impulsar_y, 60, 40);
       strokeWeight(5);
       stroke(0);
       line(850, 380, 830, 400);
       line(850, 380, 870, 400);
     };

     var carretera = function() {
       fill(89, 89, 87);
       noStroke();
       rect(0, 0, 1000, 345);

       fill(145, 145, 142);
       rect(0, 180, 1000, 10);
     };

     var panel_superior = function() {
       strokeWeight(5);
       stroke(0);
       rect(0, 0, 1000, 50);
     };


      var particulas = new ParticleSystem(car.position);
      var carro_foto = new modelo_carro();
      var gasolina = new gota();




      var lineas_carretera = function(x, y) {
        this.x = x;
        this.y = y;
        this.width = 170;
        this.height = 7;

      };

      lineas_carretera.prototype.display = function() {
        fill(255, 255, 255);
        noStroke();
        rect(this.x, this.y, this.width, this.height);

      };

      lineas_carretera.prototype.update = function() {
        this.x -= 3;

      };

      lineas_carretera.prototype.check = function() {
        if (this.x < -200) {
          this.x = 1050;
        }

      };

      var barra = function() {
        this.x = 20;
        this.y = 10;
        this.width = 400;
        this.height = 30;
        this.death = false;
        this.start= false;
      };

      barra.prototype.update = function() {
        this.width -= 0.30;

      };

      barra.prototype.display = function() {
        fill(35, 150, 0);
        noStroke();
        rect(this.x, this.y, this.width, this.height);

      };

      barra.prototype.check = function() {
        if (this.width <= 0) {
          this.death = true;
          return true;

        }
      };

      barra.prototype.sumar = function() {
        this.width+= 60;

      };

      barra.prototype.restar = function() {
        this.width-= 20;

      };

      barra.prototype.propulsor = function() {
        this.width-= 1;
      };



      var espina = function(x, y) {
        this.posicion_x = x;
        this.posicion_y = y;

      };

      espina.prototype.display = function() {
        pushMatrix();
        translate(this.posicion_x, this.posicion_y);
        stroke(204, 180, 122);
        line(0, 0, -10, -10);
        line(0, 0, 0, -10);
        line(0, 0, 10, -10);
        popMatrix();
      };

      espina.prototype.update = function() {
        this.posicion_x -= 4
      };

      espina.prototype.check = function(x, y) {
        if ((x >= (this.posicion_x - 10) && x <= ((this.posicion_x - 10) + 20)) && (y >= (this.posicion_y - 10) && (y <= this.posicion_y + 0))) {
          return true;
        }

      };

      var mensaje_derrota = function() {
        fill(133, 50, 16);
        textSize(tamaño);
        tamaño+= 0.5;
        if (tamaño > 40) {
          tamaño = 40;
        }
        text("Oh, You Lose Sorry, You Ran Out", 250, 140, 600, 300);
        text("Of Fuel, Please Press the Button", 250, 190, 600, 300);
        text("Reset for Try Again ;( ", 320, 250, 590, 300);

      };

      var mensaje_victoria = function() {
        fill(0, 191, 22);
        textSize(a);
        text("YESSS You WONN!! Congrats Sis!!", 270, 220);
        a+= 0.5;
        if (a > 30) {
          a = 30;
        }
      };

      var contador = function() {
        this.x = 730;
        this.y = 10;
        this.cajas = 0;
      };

      contador.prototype.display = function() {
        strokeWeight(5);
        stroke(105, 63, 1);
        fill(153, 93, 3);
        rect(this.x, this.y, 30, 30);

        fill(2, 204, 222);
        stroke(3, 143, 156);
        strokeWeight(3);
        ellipse(this.x + 15, this.y + 15, 10, 10);

      };

      contador.prototype.puntaje = function() {
        fill(158, 60, 3);
        textSize(25);
        text(this.cajas + "x", this.x - 50, this.y + 25)

      };

      contador.prototype.añadir = function() {
        this.cajas ++;

      };

      contador.prototype.quitar = function() {
        this.cajas --;

      };

      var linea_de_llegada = function() {
        this.x = 1100;
        this.y = 20;
        this.w = 20;
        this.win = false;
      };

      linea_de_llegada.prototype.update = function() {
        this.x -= 5;

      };


      linea_de_llegada.prototype.display = function() {
        for (var i = 60; i < 330 ; i += 40) {
          noStroke();
          fill(0, 0, 0);
          rect(this.x, i, this.w, this.w);
          rect(this.x + 20, i + this.y, this.w, this.w);
          fill(255, 255, 255);
          rect(this.x,  i + this.y, this.w, this.w);
          rect(this.x + 20, i, this.w, this.w);
        }
      };

      linea_de_llegada.prototype.check = function(x) {
        if (x >= this.x + this.w) {
          return true;
        }

      };

      var dibujo_combustible = function() {
        this.x = 450;
        this.y = 25;
        this.w = 20;

      };

      dibujo_combustible.prototype.update = function() {
        this.x -= 0.30;

      };

      dibujo_combustible.prototype.display = function() {
        fill(54, 52, 52);
        strokeWeight(5);
        stroke(18, 17, 17)
        ellipse(this.x, this.y, this.w, this.w);

      };

      dibujo_combustible.prototype.sumar = function() {
        this.x+= 60;

      };

      dibujo_combustible.prototype.restar = function() {
        this.x-= 20;

      };

      dibujo_combustible.prototype.propulsor = function() {
        this.x-= 1;
      };

      var lineas = [];

      lineas.push(new lineas_carretera(150, 100));
      lineas.push(new lineas_carretera(600, 100));
      lineas.push(new lineas_carretera(1000, 100));
      lineas.push(new lineas_carretera(150 + 70, 260));
      lineas.push(new lineas_carretera(600 + 70, 260));
      lineas.push(new lineas_carretera(1000 + 70, 260));

      var gotas_gasolina = [];
      var obstaculos = [];
      var espinas = [];

      for(var i = 0; i < 100; i++) {
        gotas_gasolina.push(new gota(i * 600 + 800, random(70, 320)));

      }

      for(var i = 0; i < 120; i++) {
        obstaculos.push(new caja(i * 500 + 700, random(70, 320)));
        espinas.push(new espina(i * 500 + 700, random(70, 320)));

      }

      var vida = new barra();
      var dibujo_contador = new contador();
      var linea_meta = new linea_de_llegada();
      var a = 0;
      var tamaño = 0;
      var combustible_dibujo = new dibujo_combustible();


    void draw() {
      panel();
      carro_foto.display();
      boton_impulsar();


      boton_encender();

      boton_apagar();


      carretera();
      panel_superior();
      dibujo_contador.display();
      dibujo_contador.puntaje();








      if (mousePressed && comprobar_2(mouseX, mouseY) && vida.death === false && linea_meta.win === false) {
        car.turnLeft();
        boton_acelerar_sin_pulsar();
        boton_derecho_sin_pulsar();
        boton_frenar_pulsado();
        boton_izquierdo_pulsado();
      } else if (mousePressed && comprobar(mouseX, mouseY) && vida.death === false && linea_meta.win === false) {
        car.turnRight();
        boton_frenar_sin_pulsar();
        boton_izquierdo_sin_pulsar();
        boton_acelerar_pulsado();
        boton_derecho_pulsado();
      } else if (mousePressed && impulsar(mouseX, mouseY) && vida.death === false && linea_meta.win === false) {
        if (vida.start === true) {
          vida.propulsor();
          combustible_dibujo.propulsor();
        }
        car.impulsor();
        boton_impulsar_pulsado();
        boton_acelerar_sin_pulsar();
        boton_derecho_sin_pulsar();
        boton_frenar_sin_pulsar();
        boton_izquierdo_sin_pulsar();
      } else if (mousePressed && apagar(mouseX, mouseY) && vida.death === false && linea_meta.win === false) {
        car.brake();
        boton_apagar_pulsado();
        boton_acelerar_sin_pulsar();
        boton_derecho_sin_pulsar();
        boton_frenar_sin_pulsar();
        boton_izquierdo_sin_pulsar();
      } else if (mousePressed && encender(mouseX, mouseY) && vida.death === false && linea_meta.win === false) {
        car.mover();
        vida.start = true;
        boton_encender_pulsado();
        boton_acelerar_sin_pulsar();
        boton_derecho_sin_pulsar();
        boton_frenar_sin_pulsar();
        boton_izquierdo_sin_pulsar();
      } else {
        boton_acelerar_sin_pulsar();
        boton_derecho_sin_pulsar();
        boton_frenar_sin_pulsar();
        boton_izquierdo_sin_pulsar();
      }

      if (car.stop === false && vida.death === false && linea_meta.win === false) {
        vida.update();
        combustible_dibujo.update();
        if (vida.check()) {
          vida.y = 1000;
          combustible_dibujo.y = 1000;
          car.acceleration.set(0, 0);
          car.velocity.set(0, 0);
        }
        vida.display();
        combustible_dibujo.display();
        for (var i = 0; i < 6; i++) {
          lineas[i].update();
          lineas[i].check();
          lineas[i].display();
        }

        for (var i = 0; i < 100; i++) {
          if (gotas_gasolina[i].check(car.position.x, car.position.y)) {
            gotas_gasolina[i].y = 1000;
            vida.sumar();
            combustible_dibujo.sumar();
          }
          gotas_gasolina[i].update();
          gotas_gasolina[i].display();
        }

        for(var i = 0; i < 120; i++) {
          if (obstaculos[i].check(car.position.x, car.position.y)) {
            obstaculos[i].y = 1000;
            dibujo_contador.añadir();
          }

          if (espinas[i].check(car.position.x, car.position.y)) {
            espinas[i].posicion_y = 1000;
            vida.restar();
            dibujo_contador.quitar();
            combustible_dibujo.restar();

          }

          obstaculos[i].update();
          espinas[i].update();
          obstaculos[i].display();
          espinas[i].display();


        }

        particulas.addParticle();
        particulas.origin = car.position;
        particulas.run();
      } else if (car.stop === true) {
        vida.display();
        combustible_dibujo.display();
        for (var i = 0; i < 6; i++) {
          lineas[i].display();
        }

        for (var i = 0; i < 100; i++) {
          gotas_gasolina[i].display();
        }

        for (var i = 0; i < 120; i++) {
          obstaculos[i].display();
          espinas[i].display();

        }

      }

      if (dibujo_contador.cajas >= 5) {
        if (linea_meta.check(car.position.x)) {
          mensaje_victoria();
          linea_meta.win = true;
          car.acceleration.set(0, 0);
          car.velocity.set(0, 0);



        }
        linea_meta.update();
        linea_meta.display();
      }

      car.update();
      car.checkEdges();
      car.display();

      if (vida.death === true) {
        mensaje_derrota();
      }
    }

  </script>

  <canvas id="mysketch"></canvas>

 </body>
</html>
